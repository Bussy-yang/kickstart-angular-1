#
#   appweb.conf -- Appweb configuration for layer2
#
#   Use this configuration file if you want to run the application stand-alone.
#   If you want to run host this application in a centrally installed Appweb,
#   use app.conf instead.

ErrorLog stdout level=4 append stamp=1hr

Listen                  127.0.0.1:5000
ListenSecure            127.0.0.1:5443

LoadModule              espHandler libmod_esp
LoadModule              sslModule libmod_ssl

SSLCertificateFile      "cert/self.crt"
SSLCertificateKeyFile   "cert/self.key"
# SSLCipherSuite        AES128-SHA

AddInputFilter          uploadFilter
AddHandler              fileHandler html gif jpeg jpg png pdf ico css js
AddHandler              espHandler

# MOB - this fails without this, should not be required??
DirectoryIndex			index.esp

# Cache client=1day extensions="html,gif,jpeg,jpg,png,pdf,ico,js"
# Cache server=1hour /cache.esp /cache.php
# LimitCache 2MB
SessionTimeout 15mins

Header remove Content-Security-Policy 
# Header set Content-Security-Policy default-src 'self'
# Header set Content-Security-Policy "allow 'self'; options inline-script; img-src 'self'
# Header set X-Frame-Options deny
# Header set X-XSS-Protection 1; mode=block

Defense notify email TO=info@example.com
Defense ban ban PERIOD=30mins
Defense record log 
#Monitor TotalErrors > 30 10sec notify ban record

AuthStore app
# Redirect secure
# Chroot - MOB

# SessionCookie visible
# - Emit cookie with httponly for session cookie
# - Emit cookie with secure if only running in secure mode?

<EspApp name="layer2">
	<Route ${ESP_SERVER_PREFIX}/dash/stream>
	    ResetPipeline
	    AddFilter               webSocketFilter
	    AddHandler              espHandler
	    Source                  dash.c
	    Target                  run dash-cmd-stream
	    #LimitWebSockets         25
	    #LimitWebSocketsMessage  10MB
	    #LimitWebSocketsPacket   8K
	    #LimitWebSocketsFrame    4K
	    #RequestTimeout          1hr
	    #InactivityTimeout       2mins
		#   WebSocketsProtocol      chat
		#   WebSocketsPing          30secs
		#   IgnoreEncodingErrors    on
		#   PreserveFrames          on
	</Route>
</EspApp>


#<EspApp name="layer2">
#    EspRoutePrefix /mob
#    EspPermResource settings
#</EspApp>

LogRoutes 
